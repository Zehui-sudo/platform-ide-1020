# 本地 Nginx 配置示例：反向代理 Next.js (端口 3000) 与 FastAPI (端口 8000)
# 将该文件保存后，可在 nginx.conf 中通过 include 引入，
# 或者直接复制内容到主配置文件的 http/server 块中。

server {
    listen 8080;
    server_name localhost;

    # 大纲与内容生成相关 API → FastAPI (uvicorn)
    location ~ ^/api/(outline|content)/ {
        proxy_pass http://127.0.0.1:8000;

        # 透传客户端信息
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # SSE 需要保持长连接，禁止缓冲
        proxy_http_version 1.1;
        proxy_set_header Connection '';
        proxy_buffering off;
        proxy_cache off;
    }

    # 其它 API → Next.js（保留原有前端接口）
    location /api/ {
        proxy_pass http://127.0.0.1:3000;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # 前端页面与静态资源 → Next.js dev server
    location / {
        proxy_pass http://127.0.0.1:3000;

        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
