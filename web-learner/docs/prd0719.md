# 代码学习平台统一需求与蓝图 (V1.1)

**文档目的:** 本文档是 "CodePath" 项目的唯一真实来源 (Single Source of Truth)，整合了产品需求文档 (PRD) 和开发蓝图，旨在为所有团队成员（包括产品、设计、开发和 AI）提供清晰、一致的架构、规范和任务指令。**所有相关活动都必须严格遵守本文档。**

---

## 1. 产品概述

### 1.1 产品愿景
让「有意愿学习代码的人」能够「快速学习代码」，通过体系化知识结构、交互式学习和实战练习，降低编程学习门槛。

### 1.2 目标用户
- 产品经理、销售、运营等非技术岗位
- 编程爱好者和初学者
- 儿童及青少年学习者
- 希望快速上手编程的人群

### 1.3 核心价值
- **知识体系化**：符合学习习惯的渐进式知识结构。
- **主动交互性**：实时查看代码运行结果，即时获得反馈。
- **理论与实践结合**：在实战中学习和巩固编程知识。

---

## 2. 项目核心原则与技术栈

- **项目名称:** CodePath
- **核心技术栈:**
    - **前端:** React 18+ (Vite)
    - **状态管理:** Zustand
    - **样式:** Tailwind CSS
    - **路由:** React Router
    - **Markdown 渲染:** `marked`
    - **代码沙箱:** (V1.0 暂不集成，预留接口)
- **开发原则:**
    1.  **组件优先:** 万物皆组件。优先思考如何将 UI 拆分为可复用的组件。
    2.  **类型安全:** 严格使用 TypeScript，杜绝 `any` 类型。
    3.  **单一数据流:** 严格遵循 Zustand 定义的状态管理模式，杜绝组件私自拉取或维护全局状态。
    4.  **代码即文档:** 使用清晰的命名和简洁的函数，让代码自解释。

---

## 3. 功能需求与核心架构

### 3.1 核心功能布局
**布局结构**：三栏式响应式设计

- **左侧：目录区 (25% 宽度)**
    - 渲染 `LearningPath` 数据结构，形成可折叠的章 (`Chapter`) 和节 (`Section`) 列表。
    - 支持折叠展开。
    - 高亮当前路由匹配的 `Section`。

- **中间：内容展示区 (50% 宽度)**
    - 根据当前 `Section` 的 `SectionContent` 动态渲染内容块 (`MarkdownBlock` 或 `InteractiveCodeBlock`)。
    - Markdown 内容需正确渲染。
    - 交互式代码块提供代码编辑、运行和结果展示功能。

- **右侧：AI 问答区 (25% 宽度) (V1.1 规划)**
    - 基于当前内容的智能问答。
    - 问题输入框和对话历史记录。

### 3.2 目录结构与文件命名
项目必须遵循以下目录结构和命名约定：
```
/src
├── /api/             # 数据获取逻辑 (V1.0: 读取本地 JSON)
│   └── learningApi.ts
├── /assets/          # 静态资源 (SVG, images)
├── /components/      # 可复用组件
│   ├── /atoms/       # 1. 原子组件 (最基础的 UI 元素)
│   │   ├── Button.tsx
│   │   ├── CodeBlock.tsx
│   │   └── MarkdownRenderer.tsx
│   └── /molecules/   # 2. 分子组件 (由原子组合而成)
│       ├── InteractiveCodeArea.tsx
│       └── SectionLink.tsx
├── /hooks/           # 自定义 React Hooks
│   └── useCurrentSection.ts
├── /pages/           # 页面级组件
│   └── LearningView.tsx
├── /store/           # 全局状态管理 (Zustand)
│   └── learningStore.ts
├── /types/           # 全局 TypeScript 类型定义
│   └── index.ts
├── /utils/           # 通用工具函数
├── App.tsx           # 应用根组件与路由配置
└── main.tsx          # 应用入口
```
- **组件命名:** `PascalCase.tsx` (e.g., `Button.tsx`)
- **Hooks 命名:** `useCamelCase.ts` (e.g., `useCurrentSection.ts`)

### 3.3 数据结构与 API 契约
应用的整个数据层必须严格遵循 `/src/types/index.ts` 中定义的 TypeScript 类型。

#### 3.3.1 目录导航数据结构 (`LearningPath`, `Chapter`, `Section`)
```typescript
// 一级目录: 学习路径 (代表一门课程)
interface LearningPath {
  id: string;      // e.g., "python-basics"
  title: string;   // e.g., "Python 核心基础"
  language: 'python' | 'javascript';
  chapters: Chapter[];
}

// 二级目录: 章 (代表一个知识模块)
interface Chapter {
  id: string;       // e.g., "py-ch-2-control-flow"
  title: string;    // e.g., "控制流程"
  sections: Section[];
}

// 三级目录: 节 (代表一个具体知识点)
interface Section {
  id: string;      // e.g., "py-sec-2-1-if-statement"
  title: string;   // e.g., "if 条件语句"
  chapterId: string; // 父章节的ID
}
```

#### 3.3.2 内容区域数据结构 (`SectionContent`, `ContentBlock`)
```typescript
// 节内容 (由内容块数组组成)
interface SectionContent {
  id: string; // 与 Section.id 对应
  contentBlocks: (MarkdownBlock | InteractiveCodeBlock)[];
}

// 内容块1: Markdown 静态内容
interface MarkdownBlock {
  type: 'markdown';
  content: string;
}

// 内容块2: 交互式代码
interface InteractiveCodeBlock {
  type: 'code';
  language: 'python' | 'javascript';
  code: string;
  isInteractive: true;
}
```

#### 3.3.3 API 契约 (`/api/learningApi.ts`)
必须实现以下函数以模拟异步数据获取：
```typescript
// 获取指定语言的学习路径结构
function getLearningPath(language: 'python' | 'javascript'): Promise<LearningPath>;

// 根据 Section ID 获取其详细内容
function getSectionContent(sectionId: string): Promise<SectionContent>;
```

### 3.4 状态管理 (Zustand)
全局状态在 `/store/learningStore.ts` 中定义，结构如下：
```typescript
interface LearningState {
  currentPath: LearningPath | null;
  currentSection: SectionContent | null;
  loading: {
    path: boolean;
    section: boolean;
  };
  error: {
    path: string | null;
    section: string | null;
  };
  userCodeSnippets: Record<string, string>; // Key: SectionID, Value: User's code
}

interface LearningActions {
  loadPath: (language: 'python' | 'javascript') => Promise<void>;
  loadSection: (sectionId: string) => Promise<void>;
  updateUserCode: (sectionId: string, code: string) => void;
}
```
**建议:** 使用 Zustand 的 `persist` 中间件将 `userCodeSnippets` 持久化到 localStorage。

### 3.5 路由设计 (React Router)
- `/`: 首页，重定向到 `/learn/python`。
- `/learn/:language/:chapterId/:sectionId`: 核心学习页面。

---

## 4. 开发规范与界面设计

### 4.1 代码风格
- **格式化:** 使用 Prettier。`.prettierrc.json` 配置如下：
  ```json
  {
    "semi": true,
    "singleQuote": true,
    "trailingComma": "es5",
    "printWidth": 80,
    "tabWidth": 2
  }
  ```
- **Linting:** 使用 ESLint，并启用 `eslint-plugin-react-hooks` 规则。

### 4.2 依赖管理
- **包管理器:** `npm`
- **关键依赖:** `react`, `react-dom`, `react-router-dom`, `zustand`, `tailwindcss`, `marked`, `typescript`, `vite`。

### 4.3 界面风格与布局
- **风格**: 简洁、现代，支持暗色模式。
- **布局**:
    - **导航栏**：顶部固定，包含Logo、课程选择、用户中心。
    - **主内容区**：三栏式布局。
    - **页脚**：版权信息、联系方式。

### 4.4 格式规范 (CSS)
项目的基础样式和主题变量定义在 `src/index.css` 中，所有组件都应遵循这些规范。
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: oklch(0.9818 0.0054 95.0986);
    --foreground: oklch(0.3438 0.0269 95.7226);
    --card: oklch(0.9818 0.0054 95.0986);
    --card-foreground: oklch(0.1908 0.0020 106.5859);
    --popover: oklch(1.0000 0 0);
    --popover-foreground: oklch(0.2671 0.0196 98.9390);
    --primary: oklch(0.6171 0.1375 39.0427);
    --primary-foreground: oklch(1.0000 0 0);
    --secondary: oklch(0.9245 0.0138 92.9892);
    --secondary-foreground: oklch(0.4334 0.0177 98.6048);
    --muted: oklch(0.9341 0.0153 90.2390);
    --muted-foreground: oklch(0.6059 0.0075 97.4233);
    --accent: oklch(0.9245 0.0138 92.9892);
    --accent-foreground: oklch(0.2671 0.0196 98.9390);
    --destructive: oklch(0.1908 0.0020 106.5859);
    --destructive-foreground: oklch(1.0000 0 0);
    --border: oklch(0.8847 0.0069 97.3627);
    --input: oklch(0.7621 0.0156 98.3528);
    --ring: oklch(0.6171 0.1375 39.0427);
    --radius: 0.5rem;
    --font-sans: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
    --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }
  .dark {
    --background: oklch(0.2679 0.0036 106.6427);
    --foreground: oklch(0.8074 0.0142 93.0137);
    --card: oklch(0.2679 0.0036 106.6427);
    --card-foreground: oklch(0.9818 0.0054 95.0986);
    --popover: oklch(0.3085 0.0035 106.6039);
    --popover-foreground: oklch(0.9211 0.0040 106.4781);
    --primary: oklch(0.6724 0.1308 38.7559);
    --primary-foreground: oklch(1.0000 0 0);
    --secondary: oklch(0.9818 0.0054 95.0986);
    --secondary-foreground: oklch(0.3085 0.0035 106.6039);
    --muted: oklch(0.2213 0.0038 106.7070);
    --muted-foreground: oklch(0.7713 0.0169 99.0657);
    --accent: oklch(0.2130 0.0078 95.4245);
    --accent-foreground: oklch(0.9663 0.0080 98.8792);
    --destructive: oklch(0.6368 0.2078 25.3313);
    --destructive-foreground: oklch(1.0000 0 0);
    --border: oklch(0.3618 0.0101 106.8928);
    --input: oklch(0.4336 0.0113 100.2195);
    --ring: oklch(0.6724 0.1308 38.7559);
  }
}

@layer base {
  * {
    @apply border-border;
  }
  body {
    @apply bg-background text-foreground;
  }
}
```

---

## 5. 质量保证

### 5.1 测试策略
- **框架:** Vitest + React Testing Library.
- **要求:**
    1.  所有位于 `/components/atoms/` 和 `/components/molecules/` 下的组件，**必须**拥有对应的 `*.test.tsx` 文件。
    2.  测试必须覆盖组件的基本渲染和用户交互。
    3.  `/store/learningStore.ts` 中的 actions **必须**有单元测试。

### 5.2 错误处理
- API 或数据加载失败时，`learningStore` 中的 `error` 字段应被设置。
- UI 层面必须监听 `error` 字段，并在其有值时，渲染一个全局的错误提示组件，而不是让页面崩溃。

---

## 6. 部署与运维

- **平台:** Vercel
- **监控:** Vercel Analytics (访问量、用户停留时间、页面加载速度)

---

## 7. 未来规划

### 7.1 V1.1
- 支持更多编程语言（如JavaScript）。
- 增加实战项目。
- 优化AI问答体验。

### 7.2 V1.2
- 用户系统与登录注册。
- 学习社区功能。
- 个性化学习路径推荐。

### 7.3 V2.0
- 多人协作编程环境。
- 企业版与团队管理功能。
- AI 智能导师系统。

---

## 8. 风险评估

### 8.1 技术风险
- AI 内容生成质量不稳定。
- 代码执行环境安全性。

### 8.2 市场风险
- 市场竞争激烈。
- 用户增长缓慢。

### 8.3 应对策略
- 优化 AI 模型和提示词 (Prompt Engineering)。
- 采用沙箱技术隔离代码执行环境。
- 持续迭代产品，提升用户体验。
- 加强市场推广和社区运营。
