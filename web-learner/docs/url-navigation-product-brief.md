# URL 导航改造需求说明

## 背景
- 学习端原有导航通过直接调用 `loadSection` 等 store 方法切换内容，URL 仅部分反映当前状态。
- 新需求希望以 `subject` / `section` 查询参数作为全局唯一的导航识别源，便于浏览器刷新、深链分享与未来的服务端渲染。

## 目标
1. **URL 单一源头**：学习界面所有入口（顶部导航、侧边栏、聊天知识点链接等）应只通过修改 URL 来驱动章节切换，页面根据 URL 同步加载内容。
2. **学科切换默认章节**：当用户切换到新的学科时，如无历史记录，则自动打开该学科的第一个知识点，保证不会出现空白阅读区。
3. **Theme Generator 入口一致化**：在主题生成器中点击“现在开始学习”，能够直接跳转到对应学科的首个知识点，并刷新到 `/learn?subject=xxx&section=yyy`，与其他入口保持一致。

## 约束与兼容
- 继续支持本地缓存的 `last-opened-section` 作为回退方案；若 URL 无 `section` 且缓存存在，则使用缓存值。
- 需兼容现有 `useLearningStore` 中关于进度、聊天等状态，不影响其他功能。
- 浏览器刷新或手动编辑 URL 时，仍能正确恢复对应章节内容。

## 验收标准（理想状态）
1. 任意入口触发的章节切换都会更新 URL，浏览器后退/前进可回到对应章节。
2. 切换学科时，若无历史记录，阅读区直接展示首节内容，不出现闪烁或空白。
3. Theme Generator 跳转后地址栏包含正确的 `subject` 和首节 `section` 参数，从该页面刷新仍会停留在同一知识点。
4. URL 中不存在“新学科 + 旧章节”等冲突组合。

---
本说明用于回顾 URL 导航改造的产品目标，以便后续讨论和调整实现方案。
