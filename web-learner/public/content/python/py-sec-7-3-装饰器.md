å¥½çš„ï¼Œæ€»å»ºç­‘å¸ˆã€‚ä½œä¸ºæ‚¨çš„ä¸–ç•Œçº§æŠ€æœ¯æ•™è‚²è€…å’ŒPythonä¸“å®¶ï¼Œæˆ‘å°†ä¸¥æ ¼éµå¾ªæ‚¨æä¾›çš„â€œæ•™å­¦è®¾è®¡å›¾â€ï¼Œä¸ºæ‚¨ç”Ÿæˆä¸€ç¯‡é«˜è´¨é‡ã€å¤šå±‚æ¬¡ã€ç»“æ„æ¸…æ™°çš„Markdownæ•™ç¨‹ã€‚

---

### ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ
è£…é¥°å™¨ï¼ˆDecoratorï¼‰æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå…è®¸æˆ‘ä»¬åœ¨**ä¸ä¿®æ”¹åŸå‡½æ•°ä»£ç **çš„å‰æä¸‹ï¼ŒåŠ¨æ€åœ°ä¸ºå‡½æ•°**æ·»åŠ é¢å¤–çš„åŠŸèƒ½**ï¼Œæ˜¯Pythonä¸­å®ç°â€œå¼€é—­åŸåˆ™â€ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰çš„å¼ºå¤§å·¥å…·ã€‚

### ğŸ’¡ ä½¿ç”¨æ–¹å¼
è£…é¥°å™¨çš„æœ¬è´¨æ˜¯ä¸€ä¸ªæ¥æ”¶å‡½æ•°ä½œä¸ºå‚æ•°å¹¶è¿”å›ä¸€ä¸ªæ–°å‡½æ•°çš„å‡½æ•°ã€‚æˆ‘ä»¬é€šå¸¸ä½¿ç”¨`@`è¯­æ³•ç³–æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚

å…¶å·¥ä½œæµç¨‹å¯ä»¥åˆ†è§£ä¸ºä¸‰æ­¥ï¼š
1.  å®šä¹‰ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°ï¼ˆä¾‹å¦‚ `my_decorator`ï¼‰ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‡½æ•° `func` ä½œä¸ºå‚æ•°ã€‚
2.  åœ¨è£…é¥°å™¨å‡½æ•°å†…éƒ¨ï¼Œå®šä¹‰ä¸€ä¸ªâ€œåŒ…è£…å‡½æ•°â€ï¼ˆä¾‹å¦‚ `wrapper`ï¼‰ï¼Œè¿™ä¸ªåŒ…è£…å‡½æ•°ä¼šæ‰§è¡Œæ–°æ·»åŠ çš„é€»è¾‘ï¼Œå¹¶è°ƒç”¨åŸå§‹çš„ `func` å‡½æ•°ã€‚
3.  è£…é¥°å™¨å‡½æ•°è¿”å›è¿™ä¸ªåŒ…è£…å‡½æ•° `wrapper`ã€‚
4.  å½“æˆ‘ä»¬å°† `@my_decorator` æ”¾åœ¨ç›®æ ‡å‡½æ•° `say_hello` ä¸Šæ–¹æ—¶ï¼ŒPythonä¼šè‡ªåŠ¨æ‰§è¡Œ `say_hello = my_decorator(say_hello)`ã€‚

è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„é€»è¾‘ç¤ºæ„å›¾ï¼š
```mermaid
graph LR
    A[åŸå§‹å‡½æ•° say_hello] --> B(ä½œä¸ºå‚æ•°ä¼ å…¥è£…é¥°å™¨)
    B --> C{è£…é¥°å™¨ my_decorator}
    C --> D[è¿”å›ä¸€ä¸ªå…¨æ–°çš„åŒ…è£…å‡½æ•° wrapper]
    E[æ–°å‡½æ•° wrapper] --> F{æ‰§è¡Œé¢å¤–åŠŸèƒ½}
    F --> G[æ‰§è¡ŒåŸå§‹å‡½æ•° say_hello]
    G --> H{å†æ¬¡æ‰§è¡Œé¢å¤–åŠŸèƒ½}
    I[æœ€ç»ˆçš„ say_hello] --> E

    style C fill:#f9f,stroke:#333,stroke-width:2px
    style E fill:#ccf,stroke:#333,stroke-width:2px
```

### ğŸ“š Level 1: åŸºç¡€è®¤çŸ¥ï¼ˆ30ç§’ç†è§£ï¼‰
æä¾›ä¸€ä¸ªæœ€ç®€å•ã€æœ€ç›´è§‚çš„ä»£ç ç¤ºä¾‹ï¼Œè®©åˆå­¦è€…ä¸€çœ¼å°±èƒ½æ˜ç™½åŸºæœ¬ç”¨æ³•ã€‚

```python
# 1. å®šä¹‰ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨
def simple_decorator(func):
    """ä¸€ä¸ªç®€å•çš„è£…é¥°å™¨ï¼Œåœ¨å‡½æ•°æ‰§è¡Œå‰åæ‰“å°ä¿¡æ¯ã€‚"""
    def wrapper():
        print("--- å‡½æ•°å¼€å§‹æ‰§è¡Œ ---")
        func()  # è°ƒç”¨åŸå§‹å‡½æ•°
        print("--- å‡½æ•°æ‰§è¡Œç»“æŸ ---")
    return wrapper

# 2. ä½¿ç”¨ @ è¯­æ³•ç³–åº”ç”¨è£…é¥°å™¨
@simple_decorator
def say_hello():
    """ä¸€ä¸ªæ‰“æ‹›å‘¼çš„å‡½æ•°ã€‚"""
    print("ä½ å¥½ï¼ŒPython!")

# 3. è°ƒç”¨è¢«è£…é¥°åçš„å‡½æ•°
say_hello()

# é¢„æœŸè¾“å‡ºç»“æœ:
# --- å‡½æ•°å¼€å§‹æ‰§è¡Œ ---
# ä½ å¥½ï¼ŒPython!
# --- å‡½æ•°æ‰§è¡Œç»“æŸ ---
```

### ğŸ“ˆ Level 2: æ ¸å¿ƒç‰¹æ€§ï¼ˆæ·±å…¥ç†è§£ï¼‰
å±•ç¤º2-3ä¸ªè¯¥çŸ¥è¯†ç‚¹çš„å…³é”®ç‰¹æ€§æˆ–é«˜çº§ç”¨æ³•ï¼Œæ¯ä¸ªç‰¹æ€§é…ä¸€ä¸ªå®Œæ•´çš„ä»£ç ç¤ºä¾‹å’Œç®€è¦è¯´æ˜ã€‚

#### ç‰¹æ€§1: ä½¿ç”¨ `functools.wraps` ä¿ç•™å‡½æ•°å…ƒä¿¡æ¯
(å¦‚æœä¸ä½¿ç”¨`@functools.wraps`ï¼Œè£…é¥°å™¨ä¼šâ€œå·èµ°â€åŸå‡½æ•°çš„å…ƒä¿¡æ¯ï¼Œå¦‚å‡½æ•°å`__name__`å’Œæ–‡æ¡£å­—ç¬¦ä¸²`__doc__`ã€‚`@wraps`å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°†åŸå‡½æ•°çš„å…ƒä¿¡æ¯å¤åˆ¶åˆ°åŒ…è£…å‡½æ•°ä¸­ã€‚)

```python
import functools

def logging_decorator(func):
    """ä¸€ä¸ªå¸¦æ—¥å¿—åŠŸèƒ½çš„è£…é¥°å™¨ã€‚"""
    # @functools.wraps(func) æ˜¯å…³é”®ï¼
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        """è¿™æ˜¯wrapperå‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚"""
        print(f"è°ƒç”¨å‡½æ•°: {func.__name__}()")
        return func(*args, **kwargs)
    return wrapper

@logging_decorator
def calculate_sum(a, b):
    """è¿™æ˜¯ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°ä¹‹å’Œçš„å‡½æ•°ã€‚"""
    return a + b

# æ‰“å°è¢«è£…é¥°åå‡½æ•°çš„å…ƒä¿¡æ¯
print(f"å‡½æ•°å: {calculate_sum.__name__}")
print(f"å‡½æ•°æ–‡æ¡£: {calculate_sum.__doc__}")

# å¦‚æœæ²¡æœ‰ @functools.wraps(func)ï¼Œè¾“å‡ºå°†ä¼šæ˜¯ï¼š
# å‡½æ•°å: wrapper
# å‡½æ•°æ–‡æ¡£: è¿™æ˜¯wrapperå‡½æ•°çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚

# é¢„æœŸè¾“å‡ºç»“æœ:
# å‡½æ•°å: calculate_sum
# å‡½æ•°æ–‡æ¡£: è¿™æ˜¯ä¸€ä¸ªè®¡ç®—ä¸¤ä¸ªæ•°ä¹‹å’Œçš„å‡½æ•°ã€‚
```

#### ç‰¹æ€§2: å¸¦å‚æ•°çš„è£…é¥°å™¨
(æœ‰æ—¶æˆ‘ä»¬å¸Œæœ›è£…é¥°å™¨æœ¬èº«å¯ä»¥æ¥æ”¶å‚æ•°ï¼Œè¿™éœ€è¦å†å¢åŠ ä¸€å±‚å‡½æ•°åµŒå¥—ã€‚æœ€å¤–å±‚å‡½æ•°æ¥æ”¶è£…é¥°å™¨çš„å‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªçœŸæ­£çš„è£…é¥°å™¨ã€‚)
```python
import time

def repeat(num_times):
    """
    ä¸€ä¸ªæ¥æ”¶å‚æ•°çš„è£…é¥°å™¨å·¥å‚ã€‚
    å®ƒè¿”å›ä¸€ä¸ªè£…é¥°å™¨ï¼Œè¯¥è£…é¥°å™¨ä¼šè®©ç›®æ ‡å‡½æ•°é‡å¤æ‰§è¡Œ N æ¬¡ã€‚
    """
    def decorator(func):
        @functools.wraps(func)
        def wrapper(*args, **kwargs):
            for i in range(num_times):
                print(f"ç¬¬ {i+1} æ¬¡æ‰§è¡Œ...")
                result = func(*args, **kwargs)
            return result
        return wrapper
    return decorator

# ä½¿ç”¨å¸¦å‚æ•°çš„è£…é¥°å™¨ï¼Œè®©å‡½æ•°é‡å¤æ‰§è¡Œ3æ¬¡
@repeat(num_times=3)
def greet(name):
    """æ‰“å°é—®å€™è¯­ã€‚"""
    print(f"ä½ å¥½, {name}!")

# è°ƒç”¨å‡½æ•°
greet("ä¸–ç•Œ")

# é¢„æœŸè¾“å‡ºç»“æœ:
# ç¬¬ 1 æ¬¡æ‰§è¡Œ...
# ä½ å¥½, ä¸–ç•Œ!
# ç¬¬ 2 æ¬¡æ‰§è¡Œ...
# ä½ å¥½, ä¸–ç•Œ!
# ç¬¬ 3 æ¬¡æ‰§è¡Œ...
# ä½ å¥½, ä¸–ç•Œ!
```

### ğŸ” Level 3: å¯¹æ¯”å­¦ä¹ ï¼ˆé¿å…é™·é˜±ï¼‰
**é™·é˜±ï¼šåŒ…è£…å‡½æ•°å¿˜è®°è¿”å›åŸå‡½æ•°çš„æ‰§è¡Œç»“æœ**ã€‚è¿™æ˜¯åˆå­¦è€…æœ€å¸¸çŠ¯çš„é”™è¯¯ä¹‹ä¸€ï¼Œå¯¼è‡´åŸå‡½æ•°å³ä¾¿æœ‰è¿”å›å€¼ï¼Œè°ƒç”¨è€…ä¹Ÿæ¥æ”¶ä¸åˆ°ã€‚

```python
# === é”™è¯¯ç”¨æ³• ===
# âŒ wrapper å‡½æ•°æ²¡æœ‰è¿”å›åŸå‡½æ•°çš„è®¡ç®—ç»“æœ
def timer_decorator_wrong(func):
    """ä¸€ä¸ªé”™è¯¯çš„è®¡æ—¶å™¨è£…é¥°å™¨ã€‚"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        func(*args, **kwargs)  # åªæ‰§è¡Œäº†ï¼Œä½†æ²¡æœ‰æ¥æ”¶å¹¶è¿”å›å…¶ç»“æœ
        end_time = time.time()
        print(f"å‡½æ•° {func.__name__} è€—æ—¶: {end_time - start_time:.4f} ç§’")
        # å¿˜è®°äº† returnï¼
    return wrapper

@timer_decorator_wrong
def add(a, b):
    return a + b

result_wrong = add(10, 20)
print(f"è®¡ç®—ç»“æœ (é”™è¯¯): {result_wrong}") # ç»“æœæ˜¯ Noneï¼Œå› ä¸º wrapper æ²¡æœ‰è¿”å›å€¼

# é¢„æœŸè¾“å‡ºç»“æœ:
# å‡½æ•° add è€—æ—¶: 0.0000 ç§’
# è®¡ç®—ç»“æœ (é”™è¯¯): None


# === æ­£ç¡®ç”¨æ³• ===
# âœ… wrapper å‡½æ•°æ­£ç¡®è¿”å›äº†åŸå‡½æ•°çš„è®¡ç®—ç»“æœ
def timer_decorator_correct(func):
    """ä¸€ä¸ªæ­£ç¡®çš„è®¡æ—¶å™¨è£…é¥°å™¨ã€‚"""
    @functools.wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        # æ¥æ”¶åŸå‡½æ•°çš„è¿”å›å€¼
        value = func(*args, **kwargs)
        end_time = time.time()
        print(f"å‡½æ•° {func.__name__} è€—æ—¶: {end_time - start_time:.4f} ç§’")
        # å°†è¿”å›å€¼ä¼ é€’å‡ºå»
        return value
    return wrapper

@timer_decorator_correct
def multiply(a, b):
    return a * b

result_correct = multiply(10, 20)
print(f"è®¡ç®—ç»“æœ (æ­£ç¡®): {result_correct}") # ç»“æœæ˜¯ 200

# é¢„æœŸè¾“å‡ºç»“æœ:
# å‡½æ•° multiply è€—æ—¶: 0.0000 ç§’
# è®¡ç®—ç»“æœ (æ­£ç¡®): 200
```

### ğŸš€ Level 4: å®æˆ˜åº”ç”¨ï¼ˆçœŸå®åœºæ™¯ï¼‰
**åœºæ™¯ï¼š** ğŸ® é­”æ³•å­¦é™¢çš„å’’è¯­æ–½æ”¾ç³»ç»Ÿ

åœ¨è¿™ä¸ªç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªå’’è¯­éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨è£…é¥°å™¨æ¥ä¸ºå’’è¯­é™„åŠ æ–½æ³•æ¡ä»¶æ£€æŸ¥ï¼ˆå¦‚é­”åŠ›å€¼ï¼‰å’Œæ–½æ³•æ•ˆæœï¼ˆå¦‚å…ƒç´ åŠ æˆï¼‰ï¼Œè€Œæ— éœ€ä¿®æ”¹æ¯ä¸ªå’’è¯­çš„åŸºç¡€å®ç°ã€‚

```python
import functools

# --- è§’è‰²çŠ¶æ€ ---
player = {
    "name": "å¤§æ³•å¸ˆè‰¾æ‹‰",
    "mana": 50,
    "max_mana": 100
}

# --- è£…é¥°å™¨ 1: é­”åŠ›æ¶ˆè€—æ£€æŸ¥ (å¸¦å‚æ•°) ---
def require_mana(cost):
    def decorator(spell_func):
        @functools.wraps(spell_func)
        def wrapper(*args, **kwargs):
            if player["mana"] >= cost:
                player["mana"] -= cost
                print(f"âœ¨ æ–½æ³•æˆåŠŸï¼æ¶ˆè€— {cost} ç‚¹é­”åŠ›ï¼Œå‰©ä½™ {player['mana']} ç‚¹ã€‚")
                return spell_func(*args, **kwargs)
            else:
                print(f"âŒ æ–½æ³•å¤±è´¥ï¼é­”åŠ›ä¸è¶³ï¼Œéœ€è¦ {cost} ç‚¹ï¼Œå½“å‰åªæœ‰ {player['mana']} ç‚¹ã€‚")
                return None
        return wrapper
    return decorator

# --- è£…é¥°å™¨ 2: å…ƒç´ åŠ æˆ ---
def elemental_infusion(element):
    def decorator(spell_func):
        @functools.wraps(spell_func)
        def wrapper(target):
            base_damage = spell_func(target)
            if element == "ç«ç„°":
                bonus_damage = int(base_damage * 0.5)
                print(f"ğŸ”¥ å’’è¯­é™„åŠ äº†ç«ç„°æ•ˆæœï¼Œé€ æˆé¢å¤– {bonus_damage} ç‚¹ç¼çƒ§ä¼¤å®³ï¼")
                return base_damage + bonus_damage
            elif element == "å†°éœœ":
                print(f"â„ï¸ å’’è¯­é™„åŠ äº†å†°éœœæ•ˆæœï¼Œ{target} çš„é€Ÿåº¦é™ä½äº†ï¼")
                return base_damage
            return base_damage
        return wrapper
    return decorator

# --- å’’è¯­å®šä¹‰ (å‡½æ•°) ---
@require_mana(cost=30)
@elemental_infusion(element="ç«ç„°")
def fireball(target):
    """å‘å°„ä¸€æšç«çƒã€‚"""
    print(f"å¯¹ {target} å‘å°„äº†ä¸€æšå¨åŠ›å·¨å¤§çš„ç«çƒ...")
    return 100  # åŸºç¡€ä¼¤å®³

@require_mana(cost=25)
def heal(target):
    """æ²»ç–—ä¸€ä¸ªç›®æ ‡ã€‚"""
    print(f"å¯¹ {target} æ–½æ”¾äº†æ²»æ„ˆä¹‹å…‰...")
    player["mana"] = min(player["max_mana"], player["mana"] + 40)
    print(f"{target} çš„é­”åŠ›æ¢å¤äº†ï¼Œå½“å‰ä¸º {player['mana']}ã€‚")
    return "æ²»ç–—æˆåŠŸ"

# --- æ¨¡æ‹Ÿæˆ˜æ–— ---
print(f"--- {player['name']} çš„å›åˆ ---")
print(f"å½“å‰é­”åŠ›: {player['mana']}/{player['max_mana']}")

print("\n1. æ–½æ”¾ã€ç«ç„°å¼ºåŒ–ç«çƒæœ¯ã€‘æ”»å‡»å“¥å¸ƒæ—...")
total_damage = fireball("å“¥å¸ƒæ—")
if total_damage:
    print(f"å¯¹å“¥å¸ƒæ—é€ æˆæ€»è®¡ {total_damage} ç‚¹ä¼¤å®³ï¼")

print(f"\nå½“å‰é­”åŠ›: {player['mana']}/{player['max_mana']}")
print("\n2. å†æ¬¡å°è¯•æ–½æ”¾ã€ç«ç„°å¼ºåŒ–ç«çƒæœ¯ã€‘...")
fireball("å“¥å¸ƒæ—") # æ­¤æ—¶é­”åŠ›ä¸è¶³

print(f"\nå½“å‰é­”åŠ›: {player['mana']}/{player['max_mana']}")
print("\n3. æ–½æ”¾ã€è‡ªæˆ‘æ²»ç–—ã€‘...")
heal("è‡ªå·±")

# é¢„æœŸè¾“å‡ºç»“æœ:
# --- å¤§æ³•å¸ˆè‰¾æ‹‰ çš„å›åˆ ---
# å½“å‰é­”åŠ›: 50/100
#
# 1. æ–½æ”¾ã€ç«ç„°å¼ºåŒ–ç«çƒæœ¯ã€‘æ”»å‡»å“¥å¸ƒæ—...
# âœ¨ æ–½æ³•æˆåŠŸï¼æ¶ˆè€— 30 ç‚¹é­”åŠ›ï¼Œå‰©ä½™ 20 ç‚¹ã€‚
# å¯¹ å“¥å¸ƒæ— å‘å°„äº†ä¸€æšå¨åŠ›å·¨å¤§çš„ç«çƒ...
# ğŸ”¥ å’’è¯­é™„åŠ äº†ç«ç„°æ•ˆæœï¼Œé€ æˆé¢å¤– 50 ç‚¹ç¼çƒ§ä¼¤å®³ï¼
# å¯¹å“¥å¸ƒæ—é€ æˆæ€»è®¡ 150 ç‚¹ä¼¤å®³ï¼
#
# å½“å‰é­”åŠ›: 20/100
#
# 2. å†æ¬¡å°è¯•æ–½æ”¾ã€ç«ç„°å¼ºåŒ–ç«çƒæœ¯ã€‘...
# âŒ æ–½æ³•å¤±è´¥ï¼é­”åŠ›ä¸è¶³ï¼Œéœ€è¦ 30 ç‚¹ï¼Œå½“å‰åªæœ‰ 20 ç‚¹ã€‚
#
# å½“å‰é­”åŠ›: 20/100
#
# 3. æ–½æ”¾ã€è‡ªæˆ‘æ²»ç–—ã€‘...
# âŒ æ–½æ³•å¤±è´¥ï¼é­”åŠ›ä¸è¶³ï¼Œéœ€è¦ 25 ç‚¹ï¼Œå½“å‰åªæœ‰ 20 ç‚¹ã€‚
```

### ğŸ’¡ è®°å¿†è¦ç‚¹
- **è¦ç‚¹1**: **è£…é¥°å™¨æ˜¯â€œå‡½æ•°åŒ…è£…å™¨â€**ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯æ¥æ”¶ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¢å¼ºç‰ˆçš„æ–°å‡½æ•°ã€‚`@è¯­æ³•`åªæ˜¯ä¸ºäº†è°ƒç”¨æ–¹ä¾¿ã€‚
- **è¦ç‚¹2**: **ä¿æŠ¤å…ƒä¿¡æ¯é `@wraps`**ã€‚ä¸ºäº†ä¸è®©è£…é¥°å™¨â€œåƒæ‰â€åŸå‡½æ•°çš„æ–‡æ¡£å’Œåå­—ï¼ŒåŠ¡å¿…ä» `functools` æ¨¡å—å¯¼å…¥å¹¶ä½¿ç”¨ `@wraps`ã€‚
- **è¦ç‚¹3**: **åˆ«å¿˜è®°`return`**ã€‚åŒ…è£…å‡½æ•°ï¼ˆwrapperï¼‰å¿…é¡»è¿”å›åŸå‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œå¦åˆ™è°ƒç”¨è€…å°†æ°¸è¿œå¾—åˆ° `None`ã€‚