## äº‹ä»¶å¾ªç¯ä¸ä»»åŠ¡ (create_task, gather)

### ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ
äº‹ä»¶å¾ªç¯æ˜¯å¼‚æ­¥ç¨‹åºçš„"è°ƒåº¦ä¸­å¿ƒ"ï¼Œè´Ÿè´£ç®¡ç†åç¨‹çš„æ‰§è¡Œé¡ºåºï¼›ä»»åŠ¡ï¼ˆTaskï¼‰æ˜¯åç¨‹çš„"æ‰§è¡Œå®¹å™¨"ï¼Œé€šè¿‡`create_task`å°†åç¨‹åŒ…è£…ä¸ºå¯è¢«äº‹ä»¶å¾ªç¯è°ƒåº¦çš„å•å…ƒï¼›`gather`ç”¨äºæ‰¹é‡ç­‰å¾…å¤šä¸ªä»»åŠ¡å®Œæˆå¹¶æ”¶é›†ç»“æœâ€”â€”ä¸‰è€…å…±åŒè§£å†³**å¤šä¸ªåç¨‹çš„å¹¶å‘æ‰§è¡Œä¸ç»“æœç®¡ç†**é—®é¢˜ï¼Œè®©å¼‚æ­¥ç¨‹åºé«˜æ•ˆæœ‰åºè¿è¡Œã€‚


### ğŸ’¡ ä½¿ç”¨æ–¹å¼
1. **å¯åŠ¨äº‹ä»¶å¾ªç¯**ï¼šç”¨`asyncio.run(main())`è‡ªåŠ¨ç®¡ç†äº‹ä»¶å¾ªç¯ï¼ˆPython 3.7+æ¨èï¼‰ï¼›  
2. **åˆ›å»ºä»»åŠ¡**ï¼š`asyncio.create_task(coro)`å°†åç¨‹è½¬ä¸ºä»»åŠ¡ï¼ˆç«‹å³åŠ å…¥äº‹ä»¶å¾ªç¯è°ƒåº¦ï¼‰ï¼›  
3. **æ‰¹é‡ç­‰å¾…ä»»åŠ¡**ï¼š`asyncio.gather(*tasks)`åŒæ—¶ç­‰å¾…å¤šä¸ªä»»åŠ¡å®Œæˆï¼Œè¿”å›ç»“æœåˆ—è¡¨ï¼ˆé¡ºåºä¸ä¼ å…¥ä»»åŠ¡ä¸€è‡´ï¼‰ã€‚


### ğŸ“š Level 1: åŸºç¡€è®¤çŸ¥ï¼ˆ30ç§’ç†è§£ï¼‰
æœ€ç®€åŒ–ç¤ºä¾‹ï¼šä¸¤ä¸ªåç¨‹é€šè¿‡ä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œè§‚å¯Ÿæ‰§è¡Œé¡ºåºã€‚
```python
import asyncio

async def say_after(delay, content):
    """å»¶è¿Ÿdelayç§’åæ‰“å°å†…å®¹"""
    await asyncio.sleep(delay)
    print(content)

async def main():
    # å°†åç¨‹åŒ…è£…ä¸ºä»»åŠ¡ï¼ˆäº‹ä»¶å¾ªç¯ä¼šè‡ªåŠ¨è°ƒåº¦ï¼‰
    task1 = asyncio.create_task(say_after(1, "Hello"))  # å»¶è¿Ÿ1ç§’
    task2 = asyncio.create_task(say_after(0.5, "World")) # å»¶è¿Ÿ0.5ç§’
    
    print("ç­‰å¾…ä»»åŠ¡å®Œæˆ...")
    await task1  # ç­‰å¾…task1æ—¶ï¼Œäº‹ä»¶å¾ªç¯ä¼šåˆ‡æ¢åˆ°task2æ‰§è¡Œ
    await task2

# å¯åŠ¨äº‹ä»¶å¾ªç¯ï¼ˆè‡ªåŠ¨å¤„ç†å¾ªç¯çš„åˆ›å»ºä¸å…³é—­ï¼‰
asyncio.run(main())
```
**é¢„æœŸè¾“å‡º**ï¼ˆé¡ºåºç”±`sleep`æ—¶é—´å†³å®šï¼‰ï¼š
```
ç­‰å¾…ä»»åŠ¡å®Œæˆ...
World  # 0.5ç§’åå…ˆæ‰“å°
Hello  # 1ç§’åæ‰“å°
```


### ğŸ“ˆ Level 2: æ ¸å¿ƒç‰¹æ€§ï¼ˆæ·±å…¥ç†è§£ï¼‰
#### ç‰¹æ€§1: ä»»åŠ¡çš„è‡ªåŠ¨è°ƒåº¦ï¼ˆäº‹ä»¶å¾ªç¯çš„"é­”æ³•"ï¼‰
äº‹ä»¶å¾ªç¯ä¼šåœ¨ä»»åŠ¡ç­‰å¾…ï¼ˆå¦‚`await asyncio.sleep`ï¼‰æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å…¶ä»–å°±ç»ªä»»åŠ¡ï¼Œå®ç°"å¹¶å‘"ã€‚
```python
import asyncio

async def work(task_name, delay):
    """æ¨¡æ‹Ÿè€—æ—¶ä»»åŠ¡"""
    print(f"[{task_name}] å¼€å§‹æ‰§è¡Œ...")
    await asyncio.sleep(delay)
    print(f"[{task_name}] æ‰§è¡Œå®Œæˆï¼")

async def main():
    # åˆ›å»º3ä¸ªä»»åŠ¡ï¼ˆå»¶è¿Ÿåˆ†åˆ«ä¸º2ã€1ã€3ç§’ï¼‰
    tasks = [
        asyncio.create_task(work("ä»»åŠ¡A", 2)),
        asyncio.create_task(work("ä»»åŠ¡B", 1)),
        asyncio.create_task(work("ä»»åŠ¡C", 3))
    ]
    
    # æ‰¹é‡ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    await asyncio.gather(*tasks)

asyncio.run(main())
```
**è¾“å‡ºç»“æœ**ï¼ˆäº‹ä»¶å¾ªç¯è‡ªåŠ¨åˆ‡æ¢ä»»åŠ¡ï¼‰ï¼š
```
[ä»»åŠ¡A] å¼€å§‹æ‰§è¡Œ...
[ä»»åŠ¡B] å¼€å§‹æ‰§è¡Œ...
[ä»»åŠ¡C] å¼€å§‹æ‰§è¡Œ...
[ä»»åŠ¡B] æ‰§è¡Œå®Œæˆï¼  # 1ç§’åå…ˆå®Œæˆ
[ä»»åŠ¡A] æ‰§è¡Œå®Œæˆï¼  # 2ç§’åå®Œæˆ
[ä»»åŠ¡C] æ‰§è¡Œå®Œæˆï¼  # 3ç§’åå®Œæˆ
```


#### ç‰¹æ€§2: gatheræ”¶é›†ä»»åŠ¡ç»“æœï¼ˆé¡ºåºä¸¥æ ¼ä¸€è‡´ï¼‰
`gather`ä¼šæŒ‰**ä¼ å…¥ä»»åŠ¡çš„é¡ºåº**è¿”å›ç»“æœï¼Œå³ä½¿ä»»åŠ¡æ‰§è¡Œé¡ºåºä¸åŒã€‚
```python
import asyncio

async def compute(x):
    """å¼‚æ­¥è®¡ç®—xçš„å¹³æ–¹ï¼ˆæ¨¡æ‹Ÿè€—æ—¶æ“ä½œï¼‰"""
    await asyncio.sleep(x)  # å»¶è¿Ÿxç§’ï¼ˆæ¨¡æ‹Ÿè®¡ç®—æ—¶é—´ï¼‰
    return x * x

async def main():
    # åŒæ—¶è¿è¡Œ3ä¸ªè®¡ç®—ä»»åŠ¡
    results = await asyncio.gather(compute(1), compute(2), compute(3))
    print("è®¡ç®—ç»“æœ:", results)  # ç»“æœé¡ºåºä¸ä¼ å…¥ä»»åŠ¡ä¸€è‡´

asyncio.run(main())
```
**è¾“å‡ºç»“æœ**ï¼š
```
è®¡ç®—ç»“æœ: [1, 4, 9]  # å³ä½¿compute(3)æœ€åå®Œæˆï¼Œç»“æœä»åœ¨ç¬¬3ä½
```


### ğŸ” Level 3: å¯¹æ¯”å­¦ä¹ ï¼ˆé¿å…é™·é˜±ï¼‰
**å¸¸è§é™·é˜±1ï¼šå¿˜è®°awaitä»»åŠ¡â†’ä»»åŠ¡æœªæ‰§è¡Œ**  
é”™è¯¯ç”¨æ³•ï¼šåˆ›å»ºä»»åŠ¡åä¸awaitï¼Œä»»åŠ¡ä¼šè¢«åƒåœ¾å›æ”¶ï¼Œæ°¸è¿œä¸ä¼šæ‰§è¡Œã€‚
```python
async def main():
    asyncio.create_task(say_after(1, "Hello"))  # æ²¡awaitï¼Œä»»åŠ¡æœªæ‰§è¡Œ
    print("ç¨‹åºç»“æŸ")

asyncio.run(main())  # è¾“å‡º"ç¨‹åºç»“æŸ"ï¼Œä½†"Hello"æ²¡æ‰“å°ï¼
```

**å¸¸è§é™·é˜±2ï¼šç›´æ¥awaitåç¨‹â†’åŒæ­¥æ‰§è¡Œ**  
é”™è¯¯ç”¨æ³•ï¼šç›´æ¥awaitåç¨‹æ˜¯**åŒæ­¥æ‰§è¡Œ**ï¼ˆä¼šé˜»å¡ç›´åˆ°åç¨‹å®Œæˆï¼‰ï¼Œå¤±å»å¹¶å‘ä¼˜åŠ¿ã€‚
```python
async def main():
    await say_after(1, "Hello")  # åŒæ­¥ç­‰å¾…1ç§’
    await say_after(0.5, "World") # å†ç­‰å¾…0.5ç§’
    # æ€»è€—æ—¶1.5ç§’ï¼ˆéå¹¶å‘ï¼‰

asyncio.run(main())
```

**æ­£ç¡®ç”¨æ³•ï¼šåˆ›å»ºä»»åŠ¡æˆ–ç”¨gather**
```python
async def main():
    # æ–¹å¼1ï¼šåˆ›å»ºä»»åŠ¡åawait
    task1 = asyncio.create_task(say_after(1, "Hello"))
    task2 = asyncio.create_task(say_after(0.5, "World"))
    await task1
    await task2

    # æ–¹å¼2ï¼šç”¨gatheræ‰¹é‡ç­‰å¾…ï¼ˆæ›´ç®€æ´ï¼‰
    await asyncio.gather(
        say_after(1, "Hello"),
        say_after(0.5, "World")
    )
```


### ğŸš€ Level 4: å®æˆ˜åº”ç”¨ï¼ˆçœŸå®åœºæ™¯ï¼‰
**åœºæ™¯**ï¼šæ¨¡æ‹Ÿå¼‚æ­¥ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆä¸åŒå»¶è¿Ÿï¼‰ï¼Œç»Ÿè®¡æ€»è€—æ—¶å¹¶æ”¶é›†ç»“æœã€‚
```python
import asyncio
import time

async def download_file(filename, delay):
    """æ¨¡æ‹Ÿæ–‡ä»¶ä¸‹è½½ï¼ˆå»¶è¿Ÿdelayç§’ï¼‰"""
    print(f"å¼€å§‹ä¸‹è½½: {filename}")
    await asyncio.sleep(delay)
    print(f"å®Œæˆä¸‹è½½: {filename}")
    return f"{filename} çš„å†…å®¹ï¼ˆå¤§å°: {delay*100}MBï¼‰"

async def main():
    # å¾…ä¸‹è½½çš„æ–‡ä»¶åˆ—è¡¨ï¼ˆæ–‡ä»¶å+ä¸‹è½½å»¶è¿Ÿï¼‰
    download_list = [
        ("report.pdf", 3),   # å»¶è¿Ÿ3ç§’
        ("photo.jpg", 1),    # å»¶è¿Ÿ1ç§’
        ("video.mp4", 2)     # å»¶è¿Ÿ2ç§’
    ]
    
    start_time = time.time()
    
    # 1. åˆ›å»ºæ‰€æœ‰ä¸‹è½½ä»»åŠ¡ï¼ˆå¹¶å‘æ‰§è¡Œï¼‰
    tasks = [
        asyncio.create_task(download_file(name, delay))
        for name, delay in download_list
    ]
    
    # 2. æ‰¹é‡ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œæ”¶é›†ç»“æœ
    results = await asyncio.gather(*tasks)
    
    end_time = time.time()
    
    # 3. è¾“å‡ºç»Ÿè®¡ä¿¡æ¯
    print(f"\n===== ä¸‹è½½å®Œæˆ =====")
    print(f"æ€»è€—æ—¶: {end_time - start_time:.2f} ç§’")  # æ€»è€—æ—¶=æœ€é•¿å»¶è¿Ÿï¼ˆ3ç§’ï¼‰
    for res in results:
        print(f"- {res}")

asyncio.run(main())
```
**è¾“å‡ºç»“æœ**ï¼š
```
å¼€å§‹ä¸‹è½½: report.pdf
å¼€å§‹ä¸‹è½½: photo.jpg
å¼€å§‹ä¸‹è½½: video.mp4
å®Œæˆä¸‹è½½: photo.jpg
å®Œæˆä¸‹è½½: video.mp4
å®Œæˆä¸‹è½½: report.pdf

===== ä¸‹è½½å®Œæˆ =====
æ€»è€—æ—¶: 3.00 ç§’
- report.pdf çš„å†…å®¹ï¼ˆå¤§å°: 300MBï¼‰
- photo.jpg çš„å†…å®¹ï¼ˆå¤§å°: 100MBï¼‰
- video.mp4 çš„å†…å®¹ï¼ˆå¤§å°: 200MBï¼‰
```


### ğŸ’¡ è®°å¿†è¦ç‚¹
- **äº‹ä»¶å¾ªç¯æ˜¯"å‘åŠ¨æœº"**ï¼šè´Ÿè´£è°ƒåº¦ä»»åŠ¡ï¼Œæ²¡æœ‰å¾ªç¯å°±æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œï¼›  
- **ä»»åŠ¡æ˜¯"å®¹å™¨"**ï¼š`create_task`å°†åç¨‹è½¬ä¸ºå¯è°ƒåº¦çš„ä»»åŠ¡ï¼Œå¿…é¡»awaitæˆ–ç”¨gatherç­‰å¾…ï¼›  
- **gatherçš„"é¡ºåºæ€§"**ï¼šç»“æœé¡ºåºä¸ä¼ å…¥ä»»åŠ¡é¡ºåºä¸€è‡´ï¼Œæ— å…³æ‰§è¡Œé¡ºåºï¼›  
- **ä¸è¦å¿˜è®°await**ï¼šæœªè¢«awaitçš„ä»»åŠ¡ä¼šè¢«é”€æ¯ï¼Œæ°¸è¿œä¸ä¼šæ‰§è¡Œï¼›  
- **åˆ›å»ºä»»åŠ¡æ‰æ˜¯å¹¶å‘**ï¼šç›´æ¥awaitåç¨‹æ˜¯åŒæ­¥ï¼Œåˆ›å»ºä»»åŠ¡æ‰æ˜¯å¼‚æ­¥å¹¶å‘ã€‚