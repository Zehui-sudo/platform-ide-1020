好的，总建筑师。我已收到关于“6.2 变量与参数”的教学设计图。在前一节中，我们学习了如何创建和运行静态的脚本，现在，我们将为这些脚本注入“灵魂”，让它们变得动态、灵活和智能。

作为您的世界级技术教育者和命令行专家，我将继续为您精心打造这篇高质量的 Markdown 教程。

---

### 章节 6.2：变量与参数

🎯 **核心概念**
变量和参数是脚本的“记忆”和“耳朵”，它们让脚本能够存储临时数据、接收外部输入，从而摆脱僵硬的“硬编码”，变得灵活通用。

💡 **使用方式**
让脚本变得动态主要有四种技术：

1.  **定义变量**: 使用 `变量名="值"` 的格式在脚本内部创建数据容器。
2.  **使用变量**: 通过在变量名前加上 `$` 符号（如 `$变量名`）来读取容器中的数据。
3.  **接收参数**: 在执行脚本时，通过 `./脚本.sh 参数1 参数2` 的方式从外部传入数据，脚本内部用 `$1`, `$2` 等来接收。
4.  **捕获输出**: 使用 `变量名=$(命令)` 的格式，将一个命令的执行结果存入变量。

📚 **Level 1: 基础认知（30秒理解）**
变量就像一个贴着标签的盒子，你可以把信息放进去，之后通过标签名再取出来。

```bash
# 创建一个名为 variables_basic.sh 的脚本
cat > variables_basic.sh << EOF
#!/bin/bash

# 1. 定义一个名为 GREETING 的变量，并把字符串 "Hello, flexible world!" 放进去
# 记住：等号两边不能有空格！
GREETING="Hello, flexible world!"

# 2. 使用 $ 符号来获取变量的值，并让 echo 命令打印它
echo $GREETING
EOF

chmod +x variables_basic.sh
./variables_basic.sh

# 预期输出:
# Hello, flexible world!
```

---

📈 **Level 2: 核心特性（深入理解）**
掌握以下三种核心技术，你的脚本将从“固定指令集”进化为“可交互程序”。

**特性1: 位置参数 (Positional Parameters) - 让脚本接收外部指令**
脚本可以像普通命令一样接收参数。在脚本内部，`$1` 代表第一个参数，`$2` 代表第二个，以此类推。`$0` 比较特殊，它代表脚本本身的文件名。

```bash
# 创建脚本 greet_user.sh
cat > greet_user.sh << EOF
#!/bin/bash
# $1 代表执行时跟在脚本名后的第一个词
# $2 代表第二个词
echo "你好, $1! 欢迎来到 $2."
echo "本次任务由脚本 '$0' 执行。"
EOF

chmod +x greet_user.sh

# 执行脚本时，在后面跟上两个参数："指挥官" 和 "火星基地"
./greet_user.sh "指挥官" "火星基地"

# 预期输出:
# 你好, 指挥官! 欢迎来到 火星基地.
# 本次任务由脚本 './greet_user.sh' 执行。
```

**特性2: 交互式输入 (Interactive Input) - 在运行中与用户对话**
使用 `read` 命令，脚本可以暂停运行，等待用户输入信息，然后将输入的内容存入一个变量。

```bash
# 创建脚本 ask_name.sh
cat > ask_name.sh << EOF
#!/bin/bash
# 使用 read -p "提示信息" 变量名 来获取用户输入
# -p (prompt) 选项可以在同一行显示提示信息，更美观
read -p "请输入您的代号: " agent_name

echo "代号确认: $agent_name。任务即将开始..."
EOF

chmod +x ask_name.sh

# 执行脚本，它会停下来等待你输入
./ask_name.sh

# (假设你输入 "007" 并按回车后)
# 预期输出:
# 请输入您的代号: 007
# 代号确认: 007。任务即将开始...
```

**特性3: 命令替换 (Command Substitution) - 捕获命令的输出**
有时，你需要将一个命令的执行结果（而不是命令本身）保存起来。这时，使用 `$(...)` 结构就能实现。

```bash
# 创建脚本 log_creator.sh
cat > log_creator.sh << EOF
#!/bin/bash
# 使用 $(...) 将 date 命令的输出结果赋值给 CURRENT_DATE 变量
# "+%F" 是 date 命令的格式化参数，表示 年-月-日
CURRENT_DATE=$(date +%F)
LOG_FILENAME="app-${CURRENT_DATE}.log"

echo "日志文件已生成: $LOG_FILENAME"
# 实际应用中，这里会把日志内容写入该文件
touch $LOG_FILENAME
EOF

chmod +x log_creator.sh
./log_creator.sh

# 预期输出 (日期会是当前的):
# 日志文件已生成: app-2023-10-27.log
```

---

🔍 **Level 3: 对比学习（避免陷阱）**
初学者在定义变量时最容易犯的错误，就是赋值时在 `=` 两边加了空格。

```bash
# === 错误用法 ===
# ❌ 在等号两边添加空格

# 1. 创建脚本
cat > bad_assign.sh << EOF
#!/bin/bash
# 注意 "=" 两边的空格，这是错误的
MISSION_NAME = "探索未知"
echo $MISSION_NAME
EOF

# 2. 赋予权限并尝试执行
chmod +x bad_assign.sh
./bad_assign.sh

# 你会看到这样的错误信息:
# ./bad_assign.sh: line 3: MISSION_NAME: command not found

# 解释为什么是错的:
# 在 Shell 脚本中，变量赋值的语法非常严格，`=` 两边绝对不能有空格。
# 当你写下 `MISSION_NAME = "探索未知"` 时，Shell 会误以为 `MISSION_NAME` 是一个命令，
# 而 `= "探索未知"` 是它的参数，因此会报“命令未找到”的错误。

# === 正确用法 ===
# ✅ 等号两边紧密连接

# 1. 创建脚本
cat > good_assign.sh << EOF
#!/bin/bash
# 正确的赋值方式，"=" 两边没有空格
MISSION_NAME="探索未知"
echo "当前任务: $MISSION_NAME"
EOF

# 2. 赋予权限并执行
chmod +x good_assign.sh
./good_assign.sh

# 预期输出:
# 当前任务: 探索未知

# 解释为什么这样是对的:
# `变量名=值` 是 Shell 中固定且唯一的赋值语法。这种紧凑的格式能让解释器明确地知道这是一个赋值操作，而不是命令执行。
```

---

🚀 **Level 4: 实战应用（真实场景）**
**场景示例：🍕 披萨订单自动处理器**
你正在为一家披萨店编写一个自动接单脚本。这个脚本需要能够接收顾客点的披萨类型和尺寸，询问顾客姓名，并生成一个带时间戳的订单确认单。

```bash
# 脚本名称: pizza_order.sh

# 1. 创建并编写脚本
cat > pizza_order.sh << 'EOF'
#!/bin/bash
# --- 🍕 披萨订单自动处理器 ---

# 1. 从命令行参数获取披萨类型和尺寸 ($1 和 $2)
PIZZA_TYPE=$1
PIZZA_SIZE=$2

# 检查参数是否为空，如果为空则提示并退出
if [ -z "$PIZZA_TYPE" ] || [ -z "$PIZZA_SIZE" ]; then
  echo "错误: 请提供披萨类型和尺寸！"
  echo "用法: ./pizza_order.sh <类型> <尺寸>"
  echo "例如: ./pizza_order.sh 意大利辣香肠 12寸"
  exit 1
fi

# 2. 使用命令替换生成一个唯一的订单ID
# 格式：PIZZA-年-月-日-时分秒
ORDER_ID="PIZZA-$(date +%Y%m%d-%H%M%S)"

# 3. 通过交互式输入获取顾客姓名
read -p "你好！请输入您的姓名以便我们处理订单: " CUSTOMER_NAME

# 4. 清理屏幕并打印格式化的订单确认信息
clear
echo -e "\033[1;33m⭐ 订单确认 ⭐\033[0m"
echo "======================================"
echo "订单ID:      $ORDER_ID"
echo "顾客姓名:    $CUSTOMER_NAME"
echo "披萨类型:    $PIZZA_TYPE"
echo "披萨尺寸:    $PIZZA_SIZE"
echo "======================================"
echo -e "\n\033[1;32m✅ 您的订单已收到！美味披萨正在制作中，请稍候！\033[0m"
EOF

# 2. 赋予执行权限
chmod +x pizza_order.sh

# 3. 执行脚本，并传入参数 "夏威夷" 和 "12寸"
# 脚本会暂停，等待你输入姓名
./pizza_order.sh "夏威夷" "12寸"
```

**运行脚本后的交互与预期输出：**
（首先，终端会显示提示，等待你输入）
```
你好！请输入您的姓名以便我们处理订单: 
```
（你输入“王小明”并按回车后，屏幕会清空并显示如下内容）
```
⭐ 订单确认 ⭐
======================================
订单ID:      PIZZA-20231027-164530
顾客姓名:    王小明
披萨类型:    夏威夷
披萨尺寸:    12寸
======================================

✅ 您的订单已收到！美味披萨正在制作中，请稍候！
```

---

💡 **记忆要点**
- **要点1: `赋值无空格`**: `变量名="值"`，等号两边绝对不能有空格，这是最常见的语法错误。
- **要点2: `取值用美元`**: 使用变量时，必须在变量名前加上 `$` 符号，如 `$MY_VAR`。
- **要点3: `参数按位取`**: `$1`, `$2`... 分别代表从命令行传入的第一个、第二个参数，是脚本与外部世界沟通的桥梁。
- **要点4: `命令变变量`**: `$(命令)` 结构可以“捕获”命令的输出结果，并将其赋值给一个变量，是动态生成数据的关键。