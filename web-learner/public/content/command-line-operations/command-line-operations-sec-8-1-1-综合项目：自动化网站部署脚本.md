# 8.1 ç»¼åˆé¡¹ç›®ï¼šè‡ªåŠ¨åŒ–ç½‘ç«™éƒ¨ç½²è„šæœ¬

### ğŸ¯ æ ¸å¿ƒæ¦‚å¿µ
è‡ªåŠ¨åŒ–ç½‘ç«™éƒ¨ç½²è„šæœ¬æ—¨åœ¨å°†é‡å¤ç¹ççš„æ‰‹åŠ¨éƒ¨ç½²æµç¨‹æ ‡å‡†åŒ–ã€è‡ªåŠ¨åŒ–ï¼Œä»è€Œæé«˜æ•ˆç‡ã€å‡å°‘é”™è¯¯å¹¶ç¡®ä¿å‘å¸ƒçš„ä¸€è‡´æ€§ã€‚

### ğŸ’¡ ä½¿ç”¨æ–¹å¼
è‡ªåŠ¨åŒ–ç½‘ç«™éƒ¨ç½²è„šæœ¬çš„æ ¸å¿ƒåœ¨äºæ•´åˆä¸€ç³»åˆ—å‘½ä»¤è¡Œå·¥å…·å’Œè„šæœ¬ç¼–ç¨‹é€»è¾‘ï¼Œä»¥å®ç°ä»ä»£ç ä»“åº“åˆ°ç”Ÿäº§æœåŠ¡å™¨çš„è‡ªåŠ¨äº¤ä»˜ã€‚å…¶å…¸å‹ä½¿ç”¨æ–¹å¼å’Œæ„å»ºæ­¥éª¤å¦‚ä¸‹ï¼š

1.  **ç¯å¢ƒå‡†å¤‡**ï¼š
    *   **SSHå¯†é’¥é…ç½®**ï¼šç¡®ä¿æœ¬åœ°éƒ¨ç½²æœºï¼ˆæˆ–CI/CDæœåŠ¡å™¨ï¼‰ä¸è¿œç¨‹ç›®æ ‡æœåŠ¡å™¨ä¹‹é—´å·²é…ç½®SSHå…å¯†ç™»å½•ã€‚è¿™æ˜¯è¿œç¨‹æ‰§è¡Œå‘½ä»¤å’Œä¼ è¾“æ–‡ä»¶çš„åŸºç¡€ã€‚
    *   **ä»£ç ä»“åº“è®¿é—®**ï¼šéƒ¨ç½²æœºéœ€è¦æœ‰æƒé™è®¿é—®Gitä»£ç ä»“åº“ï¼ˆå¦‚GitHub, GitLab, Bitbucketï¼‰ï¼Œé€šå¸¸é€šè¿‡SSHå¯†é’¥æˆ–ä»¤ç‰Œï¼ˆTokenï¼‰å®ç°ã€‚
    *   **ç›®æ ‡ç›®å½•è§„åˆ’**ï¼šæ˜ç¡®è¿œç¨‹æœåŠ¡å™¨ä¸Šä»£ç éƒ¨ç½²ã€æ—¥å¿—ã€é™æ€æ–‡ä»¶ç­‰çš„å­˜æ”¾è·¯å¾„ã€‚

2.  **ä»£ç æ‹‰å–ä¸å‡†å¤‡**ï¼š
    *   **Gitæ“ä½œ**ï¼šè„šæœ¬é¦–å…ˆä¼šåœ¨æœ¬åœ°å·¥ä½œç›®å½•ï¼ˆæˆ–CI/CDç¯å¢ƒçš„ä¸´æ—¶ç›®å½•ï¼‰ä¸­æ‰§è¡Œ`git pull`æˆ–`git clone`ï¼Œè·å–æœ€æ–°ç‰ˆæœ¬çš„ä»£ç ã€‚
    *   **ä¾èµ–å®‰è£…ä¸æ„å»º**ï¼ˆè‹¥æœ‰ï¼‰ï¼šå¯¹äºå‰ç«¯é¡¹ç›®ï¼ˆå¦‚React, Vueï¼‰æˆ–åç«¯éœ€è¦ç¼–è¯‘çš„é¡¹ç›®ï¼ˆå¦‚Java, Goï¼‰ï¼Œä¼šæ‰§è¡Œç›¸åº”çš„æ„å»ºå‘½ä»¤ï¼Œå¦‚`npm install && npm run build`ã€`mvn package`ç­‰ï¼Œç”Ÿæˆå¯éƒ¨ç½²çš„äº§ç‰©ã€‚

3.  **æ–‡ä»¶åŒæ­¥ä¸éƒ¨ç½²**ï¼š
    *   **è¿œç¨‹ä¼ è¾“**ï¼šä½¿ç”¨`rsync`æˆ–`scp`å‘½ä»¤å°†æœ¬åœ°æ„å»ºå¥½çš„ä»£ç æˆ–éƒ¨ç½²äº§ç‰©å®‰å…¨ã€é«˜æ•ˆåœ°ä¼ è¾“åˆ°è¿œç¨‹æœåŠ¡å™¨çš„ç›®æ ‡ç›®å½•ã€‚`rsync`å› å…¶å¢é‡åŒæ­¥ç‰¹æ€§ï¼Œåœ¨æ›´æ–°éƒ¨ç½²æ—¶æ›´ä¸ºå¸¸ç”¨ã€‚

4.  **è¿œç¨‹æ“ä½œä¸æœåŠ¡ç®¡ç†**ï¼š
    *   **SSHè¿œç¨‹æ‰§è¡Œ**ï¼šé€šè¿‡SSHè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‰§è¡Œä¸€ç³»åˆ—éƒ¨ç½²åå‘½ä»¤ã€‚è¿™å¯èƒ½åŒ…æ‹¬ï¼š
        *   é‡å¯WebæœåŠ¡å™¨ï¼ˆå¦‚`sudo systemctl restart nginx` / `sudo systemctl restart apache2`ï¼‰ã€‚
        *   é‡å¯åº”ç”¨æœåŠ¡ï¼ˆå¦‚`sudo systemctl restart myapp`ï¼‰ã€‚
        *   è¿è¡Œæ•°æ®åº“è¿ç§»ï¼ˆå¦‚`php artisan migrate` / `python manage.py migrate`ï¼‰ã€‚
        *   æ¸…é™¤ç¼“å­˜ã€ç”Ÿæˆé™æ€æ–‡ä»¶ç­‰ã€‚
    *   **æƒé™ç®¡ç†**ï¼šç¡®ä¿è¿œç¨‹æ‰§è¡Œçš„å‘½ä»¤å…·æœ‰å¿…è¦çš„æƒé™ï¼Œå¯èƒ½æ¶‰åŠ`sudo`ã€‚

5.  **é”™è¯¯å¤„ç†ä¸é€šçŸ¥**ï¼š
    *   **å¥å£®æ€§è®¾è®¡**ï¼šè„šæœ¬åº”åŒ…å«é”™è¯¯æ£€æŸ¥æœºåˆ¶ï¼Œä¾‹å¦‚ï¼Œæ£€æŸ¥å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç ï¼ˆ`$?`ï¼‰ï¼Œä¸€æ—¦æŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåº”ç«‹å³ä¸­æ­¢éƒ¨ç½²å¹¶æŠ¥å‘Šé”™è¯¯ã€‚
    *   **æ—¥å¿—è®°å½•**ï¼šè®°å½•éƒ¨ç½²è¿‡ç¨‹ä¸­çš„å…³é”®æ­¥éª¤ã€è¾“å‡ºå’Œæ½œåœ¨é”™è¯¯ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜ã€‚
    *   **é€šçŸ¥æœºåˆ¶**ï¼šéƒ¨ç½²æˆåŠŸæˆ–å¤±è´¥åï¼Œé€šè¿‡é‚®ä»¶ã€Slackã€Webhookç­‰æ–¹å¼é€šçŸ¥ç›¸å…³äººå‘˜ã€‚

**è„šæœ¬ç¼–ç¨‹è¯­è¨€é€‰æ‹©**ï¼š
é€šå¸¸ä½¿ç”¨Shellè„šæœ¬ï¼ˆå¦‚Bashï¼‰æ¥ç¼–å†™ï¼Œå› ä¸ºå®ƒèƒ½ç›´æ¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤ï¼Œæ˜“äºé›†æˆã€‚å¯¹äºæ›´å¤æ‚çš„é€»è¾‘å’Œé«˜çº§ç‰¹æ€§ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Pythonç­‰è„šæœ¬è¯­è¨€ã€‚

æ„å»ºä¸€ä¸ªè‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬ï¼Œå³æ˜¯æŠŠè¿™äº›ç¦»æ•£çš„å‘½ä»¤è¡Œæ“ä½œï¼Œç”¨è„šæœ¬è¯­è¨€çš„é€»è¾‘ä¸²è”èµ·æ¥ï¼Œå®ç°ä¸€é”®å¼æˆ–è§¦å‘å¼çš„è‡ªåŠ¨éƒ¨ç½²ã€‚

### ğŸ“š Level 1: åŸºç¡€è®¤çŸ¥ï¼ˆ30ç§’ç†è§£ï¼‰
é€šè¿‡ä¸€ä¸ªç®€å•çš„Shellè„šæœ¬ï¼Œæˆ‘ä»¬æ¼”ç¤ºè‡ªåŠ¨åŒ–éƒ¨ç½²çš„æ ¸å¿ƒæµç¨‹ï¼šä»â€œæ‹‰å–â€ä»£ç åˆ°â€œéƒ¨ç½²â€åˆ°æ¨¡æ‹Ÿçš„è¿œç¨‹ç›®å½•ï¼Œå¹¶â€œæ¨¡æ‹Ÿè¿œç¨‹æ‰§è¡Œâ€ä¸€ä¸ªå‘½ä»¤ã€‚è¿™ä¸ªç¤ºä¾‹å°†æ‰€æœ‰æ“ä½œéƒ½åœ¨æœ¬åœ°å®Œæˆï¼Œä»¥å¸®åŠ©ä½ å¿«é€Ÿç†è§£å…¶åŸºæœ¬å·¥ä½œåŸç†ã€‚

```bash
#!/bin/bash

# --- å‡†å¤‡å·¥ä½œï¼šåˆ›å»ºä¸´æ—¶ç›®å½•å’Œæ–‡ä»¶ä»¥æ¨¡æ‹ŸçœŸå®ç¯å¢ƒ ---
# æ¸…ç†å¯èƒ½å­˜åœ¨çš„æ—§æ¨¡æ‹Ÿç¯å¢ƒ
if [ -d "temp_local_repo" ]; then rm -rf "temp_local_repo"; fi
if [ -d "temp_remote_server" ]; then rm -rf "temp_remote_server"; fi

# 1. æ¨¡æ‹Ÿæœ¬åœ°ä»£ç ä»“åº“ï¼šåˆ›å»ºä¸€ä¸ªç®€å•çš„Gité¡¹ç›®
echo "--- 1. æ¨¡æ‹Ÿæœ¬åœ°ä»£ç ä»“åº“å¹¶åˆ›å»ºåˆå§‹æ–‡ä»¶ ---"
mkdir temp_local_repo && cd temp_local_repo
git init -b main > /dev/null 2>&1 # åˆå§‹åŒ–Gitä»“åº“ï¼ŒæŠ‘åˆ¶è¾“å‡º
echo "<h1>Hello from My Website</h1><p>Version 1.0</p>" > index.html
git add . && git commit -m "Initial website content" > /dev/null 2>&1
echo "æœ¬åœ°ä»£ç ä»“åº“ 'temp_local_repo' å·²åˆ›å»ºï¼ŒåŒ…å« index.htmlã€‚"
cd ..

# 2. æ¨¡æ‹Ÿè¿œç¨‹æœåŠ¡å™¨çš„éƒ¨ç½²ç›®æ ‡ç›®å½•
echo "--- 2. æ¨¡æ‹Ÿè¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²ç›®å½• ---"
REMOTE_DEPLOY_DIR="temp_remote_server/var/www/mywebsite"
mkdir -p "$REMOTE_DEPLOY_DIR"
echo "æ¨¡æ‹Ÿè¿œç¨‹éƒ¨ç½²ç›®å½• '$REMOTE_DEPLOY_DIR' å·²åˆ›å»ºã€‚"

# --- æ ¸å¿ƒéƒ¨ç½²æµç¨‹ ---

# 3. éƒ¨ç½²æ“ä½œï¼šå°†æœ¬åœ°ä»£ç åŒæ­¥åˆ°è¿œç¨‹æœåŠ¡å™¨
echo "--- 3. æ‰§è¡Œéƒ¨ç½²æ“ä½œï¼šå°†æœ¬åœ°ä»£ç åŒæ­¥åˆ°è¿œç¨‹ ---"
# åœ¨çœŸå®åœºæ™¯ä¸­ï¼Œrsync å› å…¶å¢é‡åŒæ­¥ç‰¹æ€§åœ¨æ›´æ–°éƒ¨ç½²æ—¶æ›´ä¸ºå¸¸ç”¨ä¸”é«˜æ•ˆï¼Œè¿™é‡Œç”¨ cp ä»…ä½œç®€å•æ–‡ä»¶å¤åˆ¶æ¨¡æ‹Ÿï¼Œä¸å…·å¤‡å¢é‡åŒæ­¥åŠŸèƒ½ã€‚
cp -r "temp_local_repo"/* "$REMOTE_DEPLOY_DIR"/
echo "ä»£ç å·²ä» 'temp_local_repo' åŒæ­¥åˆ° '$REMOTE_DEPLOY_DIR'ã€‚"
ls -l "$REMOTE_DEPLOY_DIR"/index.html

# 4. æ¨¡æ‹Ÿè¿œç¨‹æ‰§è¡Œå‘½ä»¤ (ä¾‹å¦‚ï¼Œé‡å¯WebæœåŠ¡æˆ–æ›´æ–°çŠ¶æ€)
echo "--- 4. æ¨¡æ‹Ÿè¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼ˆä¾‹å¦‚ï¼Œé‡å¯WebæœåŠ¡ï¼‰---"
# çœŸå®åœºæ™¯ä¼šæ˜¯ï¼šssh user@remote "sudo systemctl restart nginx"
# è¿™é‡Œæˆ‘ä»¬é€šè¿‡åœ¨æ¨¡æ‹Ÿçš„è¿œç¨‹ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶æ¥è¡¨ç¤ºå‘½ä»¤æ‰§è¡Œ
echo "$(date): Web service restarted successfully after deployment." > "$REMOTE_DEPLOY_DIR"/deployment_log.txt
echo "æ¨¡æ‹Ÿè¿œç¨‹å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚è¯·æŸ¥çœ‹ '$REMOTE_DEPLOY_DIR/deployment_log.txt'ã€‚"
cat "$REMOTE_DEPLOY_DIR"/deployment_log.txt

# --- æ¸…ç†å·¥ä½œ ---
echo "--- 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ ---"
rm -rf temp_local_repo temp_remote_server
echo "ä¸´æ—¶æ–‡ä»¶å·²æ¸…ç†ã€‚"

# é¢„æœŸè¾“å‡º (æ—¥æœŸå’Œæ—¶é—´ä¼šæ ¹æ®å®é™…è¿è¡Œæ—¶é—´å˜åŒ–):
# --- 1. æ¨¡æ‹Ÿæœ¬åœ°ä»£ç ä»“åº“å¹¶åˆ›å»ºåˆå§‹æ–‡ä»¶ ---
# æœ¬åœ°ä»£ç ä»“åº“ 'temp_local_repo' å·²åˆ›å»ºï¼ŒåŒ…å« index.htmlã€‚
# --- 2. æ¨¡æ‹Ÿè¿œç¨‹æœåŠ¡å™¨éƒ¨ç½²ç›®å½• ---
# æ¨¡æ‹Ÿè¿œç¨‹éƒ¨ç½²ç›®å½• 'temp_remote_server/var/www/mywebsite' å·²åˆ›å»ºã€‚
# --- 3. æ‰§è¡Œéƒ¨ç½²æ“ä½œï¼šå°†æœ¬åœ°ä»£ç åŒæ­¥åˆ°è¿œç¨‹ ---
# ä»£ç å·²ä» 'temp_local_repo' åŒæ­¥åˆ° 'temp_remote_server/var/www/mywebsite'ã€‚
# -rw-r--r--  1 user  group    48 Feb 28 10:00 index.html # ç”¨æˆ·åã€ç»„åã€æ–‡ä»¶æƒé™ã€å¤§å°ã€æ—¥æœŸç­‰ä¼šæ ¹æ®å®é™…è¿è¡Œç¯å¢ƒæœ‰æ‰€ä¸åŒ
# --- 4. æ¨¡æ‹Ÿè¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼ˆä¾‹å¦‚ï¼Œé‡å¯WebæœåŠ¡ï¼‰--- 
# æ¨¡æ‹Ÿè¿œç¨‹å‘½ä»¤æ‰§è¡ŒæˆåŠŸã€‚è¯·æŸ¥çœ‹ 'temp_remote_server/var/www/mywebsite/deployment_log.txt'ã€‚
# Wed Feb 28 10:00:00 CST 2024: Web service restarted successfully after deployment.
# --- 5. æ¸…ç†ä¸´æ—¶æ–‡ä»¶ ---
# ä¸´æ—¶æ–‡ä»¶å·²æ¸…ç†ã€‚
```